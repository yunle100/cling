        // ... 您现有的所有JavaScript代码 ...

        // 添加iOS键盘事件处理 - 将这段代码添加到现有script标签的末尾
        function handleIOSKeyboard() {
            if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
                const messageInput = document.getElementById('messageInput');
                const chatMessages = document.getElementById('chatMessages');
                
                messageInput.addEventListener('focus', function() {
                    // 短暂延迟后滚动到底部
                    setTimeout(() => {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 300);
                });
                
                messageInput.addEventListener('blur', function() {
                    // 输入框失去焦点时，确保布局恢复正常
                    setTimeout(() => {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 100);
                });
            }
        }

        // 在页面加载完成后调用
        document.addEventListener('DOMContentLoaded', function() {
            handleIOSKeyboard();
        });

        // 如果DOMContentLoaded已经触发，也直接调用
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', handleIOSKeyboard);
        } else {
            handleIOSKeyboard();
        }
    </script>
</body>
</html>
