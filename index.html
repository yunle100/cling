<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>产品图片展示</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563EB',
            accent: '#F97316',
            success: '#10B981',
            info: '#93C5FD',
            notice: '#FFF3CD', // 公告栏黄色背景
            noticeBorder: '#FFE69C', // 公告栏边框
            noticeText: '#856404' // 公告栏文字
          }
        }
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .nav-active {
        @apply bg-primary text-white shadow-md;
      }
      .product-grid {
        @apply grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6;
      }
      .btn-effect {
        @apply transition-all duration-200 hover:shadow-md active:scale-95;
      }
    }
  </style>
  
  <style>
    /* 平滑滚动 */
    html {
      scroll-behavior: smooth;
    }
    
    /* 弹窗动画 */
    @keyframes modalOpen {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .modal-open {
      animation: modalOpen 0.3s ease forwards;
    }

    /* 付款窗口动画 */
    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .slide-up {
      animation: slideUp 0.4s ease forwards;
    }
    
    /* 隐藏输入框默认样式 */
    input[type="file"] {
      display: none;
    }
    
    /* 产品图片懒加载 */
    .product-img {
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    
    .product-img.loaded {
      opacity: 1;
    }
    
    /* 弹窗背景遮罩 */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 45;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    
    .modal-backdrop.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* 确保联系客服弹窗在最上层 */
    #contact-modal {
      z-index: 1000 !important;
    }
    
    #contact-backdrop {
      z-index: 999 !important;
    }

    /* 播放图标样式 - 居中显示在产品图上 */
    .play-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
      cursor: pointer;
      z-index: 10;
    }
    
    /* 鼠标悬停时显示播放图标并添加缩放效果 */
    .product-image-container:hover .play-icon {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.05);
    }
    
    /* 产品图片容器样式调整 */
    .product-image-container {
      position: relative;
      overflow: hidden;
    }
  </style>
</head>

<body class="bg-gray-50 font-sans text-gray-800">
  <!-- 导航栏 - 椭圆按钮样式 -->
  <header class="sticky top-0 z-50 bg-white shadow-md py-3">
    <div class="container mx-auto px-2">
      <nav class="flex items-center justify-between">
        <!-- 5个椭圆按钮 -->
        <button class="nav-btn nav-active flex-1 mx-1 py-2 px-3 text-center font-medium rounded-full transition-all duration-300" data-category="1">
          首页
        </button>
        <button class="nav-btn flex-1 mx-1 py-2 px-3 text-center font-medium bg-gray-100 hover:bg-gray-200 rounded-full transition-all duration-300" data-category="2">
          真人
        </button>
        <button class="nav-btn flex-1 mx-1 py-2 px-3 text-center font-medium bg-gray-100 hover:bg-gray-200 rounded-full transition-all duration-300" data-category="3">
          写真
        </button>
        <button class="nav-btn flex-1 mx-1 py-2 px-3 text-center font-medium bg-gray-100 hover:bg-gray-200 rounded-full transition-all duration-300" data-category="4">
          漫画
        </button>
        <button class="nav-btn flex-1 mx-1 py-2 px-3 text-center font-medium bg-gray-100 hover:bg-gray-200 rounded-full transition-all duration-300" data-category="5">
          动漫
        </button>
      </nav>
    </div>
  </header>

  <!-- 公告栏 - 黄色 -->
  <div class="bg-notice border-l-4 border-noticeBorder py-3 px-4">
    <div class="container mx-auto flex items-center">
      <i class="fa fa-bullhorn text-noticeText mr-3 text-lg"></i>
      <p class="text-sm md:text-base text-noticeText">
        <span class="font-medium">公告：</span>本店所有产品支持7天无理由退换，满299元免运费
      </p>
    </div>
  </div>

  <!-- 主内容区 -->
  <main class="container mx-auto px-4 py-8">
    <!-- 产品展示标题 -->
    <div class="mb-8 text-center">
      <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold mb-2">产品展示</h1>
      <p class="text-gray-600 max-w-2xl mx-auto">浏览我们的精选产品，点击图片查看详情</p>
    </div>
    
    <!-- 产品网格 -->
    <div id="product-grid" class="product-grid">
      <!-- 产品卡片将通过JS动态生成 -->
    </div>
    
    <!-- 加载更多按钮 -->
    <div class="mt-8 text-center">
      <button id="load-more" class="text-primary hover:text-primary/80 font-medium flex items-center justify-center mx-auto transition-colors">
        <span>加载更多</span>
        <i class="fa fa-angle-down ml-1"></i>
      </button>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-gray-800 text-white py-8 mt-16">
    <div class="container mx-auto px-4 text-center">
      <p>&copy; 2023 产品展示平台 版权所有</p>
    </div>
  </footer>

  <!-- 产品详情弹窗 -->
  <div id="product-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto modal-open">
      <div class="relative">
        <!-- 关闭按钮 -->
        <button id="close-modal" class="absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 transition-colors z-10">
          <i class="fa fa-times"></i>
        </button>
        
        <!-- 弹窗内容 -->
        <div class="grid md:grid-cols-2 gap-6 p-4 md:p-6">
          <div class="modal-image-container flex items-center justify-center p-4">
            <img id="modal-image" src="" alt="产品详情图" class="w-full max-h-[300px] md:max-h-[400px] object-contain rounded-lg">
          </div>
          <div class="modal-content">
            <h2 id="modal-title" class="text-2xl font-bold mb-2"></h2>
            <div class="flex items-center mb-4">
              <div id="modal-rating" class="flex text-accent mr-4"></div>
              <div id="modal-views" class="text-gray-500 text-sm flex items-center">
                <i class="fa fa-eye mr-1"></i> <span></span>
              </div>
            </div>
            <div id="modal-description" class="text-gray-600 mb-6"></div>
            <div class="flex">
              <button id="open-payment-from-product" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-colors btn-effect w-full">
                加入购物车
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 联系客服弹窗 -->
  <div id="contact-modal" class="fixed inset-0 hidden items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-auto modal-open relative">
      <!-- 关闭按钮 -->
      <button id="close-contact" class="absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 transition-colors z-10 shadow-md">
        <i class="fa fa-times"></i>
      </button>
      
      <div class="p-6">
        <h2 class="text-xl font-bold mb-4 text-center">客服联系方式</h2>
        <div class="flex justify-center mb-4">
          <img src="https://picsum.photos/seed/service/300/200" alt="客服联系方式" class="max-w-full h-auto rounded-lg shadow-sm">
        </div>
        <p class="text-center text-gray-600 text-sm">工作时间：周一至周日 9:00-21:00</p>
      </div>
    </div>
  </div>

  <!-- 底部悬浮付款按钮 -->
  <button id="payment-toggle" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-primary text-white px-10 py-3 rounded-full shadow-lg flex items-center justify-center z-40 hover:bg-primary/90 transition-colors btn-effect min-w-[200px]">
    <i class="fa fa-lock mr-2"></i>
    <span>立即付款</span>
  </button>

  <!-- 付款窗口背景遮罩 -->
  <div id="payment-backdrop" class="modal-backdrop"></div>
  
  <!-- 付款窗口 -->
  <div id="payment-window" class="fixed bottom-0 left-0 right-0 bg-white shadow-2xl rounded-t-2xl max-w-md mx-auto z-50 hidden slide-up">
    <!-- 付款窗口头部 -->
    <div class="bg-primary text-white p-4 rounded-t-2xl flex items-center justify-between">
      <h3 class="font-semibold text-lg">付款中心</h3>
      <!-- 明显的关闭按钮 -->
      <button id="close-payment" class="w-8 h-8 flex items-center justify-center rounded-full bg-white/20 hover:bg-white/30 transition-colors">
        <i class="fa fa-times text-white"></i>
      </button>
    </div>
    
    <!-- 付款内容区域 -->
    <div class="p-4 max-h-[70vh] overflow-y-auto" id="payment-content">
      <!-- 介绍和收款码区域 -->
      <div class="mb-6 bg-primary/5 border border-primary/20 rounded-xl p-4">
        <div class="flex items-start mb-3">
          <i class="fa fa-info-circle text-primary mt-0.5 mr-2"></i>
          <h4 class="font-medium text-gray-800">购买说明</h4>
        </div>
        <p class="text-gray-600 text-sm mb-4 pl-6">
          感谢您的购买！请扫描下方二维码完成支付，支付成功后我们将尽快为您安排发货。
        </p>
        
        <div class="flex justify-center mb-3">
          <img src="https://picsum.photos/seed/payment/200/200" alt="收款二维码" class="w-40 h-40 object-cover border-2 border-white p-2 rounded-lg shadow-md">
        </div>
        
        <p class="text-gray-500 text-xs text-center">
          请在支付后上传付款凭证以便我们快速确认
        </p>
      </div>
      
      <!-- 上传图片区域 -->
      <div class="mb-6">
        <h4 class="font-medium text-gray-800 mb-3">上传付款凭证</h4>
        <label for="receipt-upload" class="block w-full border-2 border-dashed border-success rounded-lg p-3 text-center cursor-pointer hover:bg-success/5 transition-colors">
          <div class="inline-flex flex-col items-center">
            <i class="fa fa-cloud-upload text-success text-lg mb-1"></i>
            <span class="text-gray-600 text-sm">点击上传或拖放图片</span>
            <span class="text-gray-400 text-xs mt-0.5">支持JPG、PNG格式</span>
          </div>
          <input type="file" id="receipt-upload" accept="image/*" class="hidden">
        </label>
      </div>
      
      <!-- 上传后显示的板块 -->
      <div id="uploaded-section" class="mb-6 hidden" style="scroll-margin-top: 20px;">
        <div class="border border-success/30 rounded-lg bg-success/5 overflow-hidden">
          <div class="p-3 border-b border-success/20">
            <h4 class="font-medium text-gray-800 flex items-center">
              <i class="fa fa-check-circle text-success mr-2"></i>
              已上传付款凭证
            </h4>
          </div>
          
          <!-- 固定的图片显示区域 -->
          <div class="p-3 bg-white">
            <img id="receipt-preview" src="https://picsum.photos/seed/receipt/400/300" alt="付款凭证" class="w-full h-auto rounded shadow-sm mb-4">
          </div>
          
          <div class="p-3 grid grid-cols-3 gap-2">
            <button class="bg-primary text-white py-2 px-3 rounded text-sm btn-effect" onclick="window.open('https://example.com/confirm', '_blank')">
              <i class="fa fa-check mr-1"></i>确认
            </button>
            <button class="bg-accent text-white py-2 px-3 rounded text-sm btn-effect" onclick="window.open('https://example.com/reupload', '_blank')">
              <i class="fa fa-refresh mr-1"></i>重新上传
            </button>
            <button class="bg-info text-gray-800 py-2 px-3 rounded text-sm btn-effect" onclick="window.open('https://example.com/logistics', '_blank')">
              <i class="fa fa-truck mr-1"></i>查物流
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 联系客服按钮 -->
    <div class="border-t p-3 bg-white">
      <button id="contact-btn" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 rounded-lg flex items-center justify-center transition-colors text-sm btn-effect">
        <i class="fa fa-headphones mr-2"></i>
        <span>联系客服</span>
      </button>
    </div>
  </div>

  <!-- 产品弹窗背景遮罩 -->
  <div id="product-backdrop" class="modal-backdrop"></div>
  <!-- 联系客服弹窗背景遮罩 -->
  <div id="contact-backdrop" class="modal-backdrop"></div>

  <script>
    // 产品图片链接集中管理 - 增加到12个产品图
    const productImages = {
      1: [
        "https://picsum.photos/seed/prod1-1/400/300", "https://picsum.photos/seed/prod1-2/400/300", 
        "https://picsum.photos/seed/prod1-3/400/300", "https://picsum.photos/seed/prod1-4/400/300", 
        "https://picsum.photos/seed/prod1-5/400/300", "https://picsum.photos/seed/prod1-6/400/300", 
        "https://picsum.photos/seed/prod1-7/400/300", "https://picsum.photos/seed/prod1-8/400/300",
        "https://picsum.photos/seed/prod1-9/400/300", "https://picsum.photos/seed/prod1-10/400/300",
        "https://picsum.photos/seed/prod1-11/400/300", "https://picsum.photos/seed/prod1-12/400/300"
      ],
      2: [
        "https://picsum.photos/seed/prod2-1/400/300", "https://picsum.photos/seed/prod2-2/400/300", 
        "https://picsum.photos/seed/prod2-3/400/300", "https://picsum.photos/seed/prod2-4/400/300", 
        "https://picsum.photos/seed/prod2-5/400/300", "https://picsum.photos/seed/prod2-6/400/300", 
        "https://picsum.photos/seed/prod2-7/400/300", "https://picsum.photos/seed/prod2-8/400/300",
        "https://picsum.photos/seed/prod2-9/400/300", "https://picsum.photos/seed/prod2-10/400/300",
        "https://picsum.photos/seed/prod2-11/400/300", "https://picsum.photos/seed/prod2-12/400/300"
      ],
      3: [
        "https://picsum.photos/seed/prod3-1/400/300", "https://picsum.photos/seed/prod3-2/400/300", 
        "https://picsum.photos/seed/prod3-3/400/300", "https://picsum.photos/seed/prod3-4/400/300", 
        "https://picsum.photos/seed/prod3-5/400/300", "https://picsum.photos/seed/prod3-6/400/300", 
        "https://picsum.photos/seed/prod3-7/400/300", "https://picsum.photos/seed/prod3-8/400/300",
        "https://picsum.photos/seed/prod3-9/400/300", "https://picsum.photos/seed/prod3-10/400/300",
        "https://picsum.photos/seed/prod3-11/400/300", "https://picsum.photos/seed/prod3-12/400/300"
      ],
      4: [
        "https://picsum.photos/seed/prod4-1/400/300", "https://picsum.photos/seed/prod4-2/400/300", 
        "https://picsum.photos/seed/prod4-3/400/300", "https://picsum.photos/seed/prod4-4/400/300", 
        "https://picsum.photos/seed/prod4-5/400/300", "https://picsum.photos/seed/prod4-6/400/300", 
        "https://picsum.photos/seed/prod4-7/400/300", "https://picsum.photos/seed/prod4-8/400/300",
        "https://picsum.photos/seed/prod4-9/400/300", "https://picsum.photos/seed/prod4-10/400/300",
        "https://picsum.photos/seed/prod4-11/400/300", "https://picsum.photos/seed/prod4-12/400/300"
      ],
      5: [
        "https://picsum.photos/seed/prod5-1/400/300", "https://picsum.photos/seed/prod5-2/400/300", 
        "https://picsum.photos/seed/prod5-3/400/300", "https://picsum.photos/seed/prod5-4/400/300", 
        "https://picsum.photos/seed/prod5-5/400/300", "https://picsum.photos/seed/prod5-6/400/300", 
        "https://picsum.photos/seed/prod5-7/400/300", "https://picsum.photos/seed/prod5-8/400/300",
        "https://picsum.photos/seed/prod5-9/400/300", "https://picsum.photos/seed/prod5-10/400/300",
        "https://picsum.photos/seed/prod5-11/400/300", "https://picsum.photos/seed/prod5-12/400/300"
      ]
    };
    
    // 生成固定的评分（3.5-5星）和浏览量（9789-23255）
    function generateFixedRatingAndViews(category, index) {
      const seed = category * 100 + index;
      
      // 生成3.5-5星的评分
      const ratingOptions = [3.5, 4, 4.5, 5];
      const ratingIndex = (seed % ratingOptions.length + ratingOptions.length) % ratingOptions.length;
      const rating = ratingOptions[ratingIndex];
      
      // 生成9789-23255之间的浏览量
      const minViews = 9789;
      const maxViews = 23255;
      const range = maxViews - minViews;
      let hash = 0;
      for (let i = 0; i < seed.toString().length; i++) {
        const char = seed.toString().charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      const views = minViews + Math.abs(hash) % range;
      
      return { rating, views };
    }
    
    // 产品数据生成函数
    function generateProductData() {
      const data = {};
      
      for (let category = 1; category <= 5; category++) {
        data[category] = productImages[category].map((image, index) => {
          const productIndex = index + 1;
          const { rating, views } = generateFixedRatingAndViews(category, productIndex);
          
          return {
            id: `${category}-${productIndex}`,
            name: `产品${category}-${productIndex}`,
            image: image,
            rating: rating,
            views: views,
            description: `产品${category}-${productIndex}的详细描述信息，包含产品特点和优势。这款产品采用优质材料制作，设计精美，深受用户喜爱。`
          };
        });
      }
      
      return data;
    }
    
    // 生成产品数据
    const productData = generateProductData();
    
    // 当前显示的类别
    let currentCategory = 1;
    let paymentOpen = false;
    
    // DOM元素
    const productGrid = document.getElementById('product-grid');
    const navButtons = document.querySelectorAll('.nav-btn');
    const productModal = document.getElementById('product-modal');
    const closeModal = document.getElementById('close-modal');
    const modalImage = document.getElementById('modal-image');
    const modalTitle = document.getElementById('modal-title');
    const modalRating = document.getElementById('modal-rating');
    const modalViews = document.getElementById('modal-views').querySelector('span');
    const modalDescription = document.getElementById('modal-description');
    const openPaymentFromProduct = document.getElementById('open-payment-from-product');
    const loadMoreBtn = document.getElementById('load-more');
    
    // 付款相关元素
    const paymentToggle = document.getElementById('payment-toggle');
    const paymentWindow = document.getElementById('payment-window');
    const closePayment = document.getElementById('close-payment');
    const receiptUpload = document.getElementById('receipt-upload');
    const uploadedSection = document.getElementById('uploaded-section');
    const receiptPreview = document.getElementById('receipt-preview');
    const paymentBackdrop = document.getElementById('payment-backdrop');
    
    // 联系客服相关元素
    const contactBtn = document.getElementById('contact-btn');
    const contactModal = document.getElementById('contact-modal');
    const closeContact = document.getElementById('close-contact');
    const contactBackdrop = document.getElementById('contact-backdrop');
    const productBackdrop = document.getElementById('product-backdrop');
    
    // 图片懒加载函数
    function lazyLoadImage(img, src) {
      const tempImg = new Image();
      tempImg.src = src;
      tempImg.onload = function() {
        img.src = src;
        img.classList.add('loaded');
      };
    }
    
    // 渲染产品网格 - 为产品2和产品5添加播放图标
    function renderProducts(category) {
      productGrid.innerHTML = '';
      const products = productData[category];
      
      products.forEach((product) => {
        const productCard = document.createElement('div');
        productCard.className = 'bg-white rounded-xl overflow-hidden shadow-md card-hover';
        
        // 创建产品图片容器（用于容纳图片和播放图标）
        const imageContainer = document.createElement('div');
        imageContainer.className = 'product-image-container bg-gray-100';
        
        const img = document.createElement('img');
        img.className = 'w-full h-auto object-cover transition-transform duration-500 hover:scale-105 cursor-pointer product-img';
        img.alt = product.name;
        img.dataset.src = product.image;
        imageContainer.appendChild(img);
        
        // 仅为产品2和产品5添加播放图标
        if (category === 2 || category === 5) {
          const playIcon = document.createElement('div');
          playIcon.className = 'play-icon';
          playIcon.innerHTML = '<i class="fa fa-play"></i>';
          // 点击播放图标也打开产品详情
          playIcon.addEventListener('click', () => openProductModal(product));
          imageContainer.appendChild(playIcon);
        }
        
        const productInfo = document.createElement('div');
        productInfo.className = 'p-4';
        
        const productName = document.createElement('h3');
        productName.className = 'font-semibold text-lg mb-2 truncate';
        productName.textContent = product.name;
        
        const productMeta = document.createElement('div');
        productMeta.className = 'flex justify-between items-center';
        
        const ratingContainer = document.createElement('div');
        ratingContainer.className = 'flex text-accent';
        
        // 处理半星评分
        const fullStars = Math.floor(product.rating);
        const hasHalfStar = product.rating % 1 !== 0;
        
        for (let i = 1; i <= fullStars; i++) {
          const star = document.createElement('i');
          star.className = 'fa fa-star';
          ratingContainer.appendChild(star);
        }
        
        if (hasHalfStar) {
          const halfStar = document.createElement('i');
          halfStar.className = 'fa fa-star-half-o';
          ratingContainer.appendChild(halfStar);
        }
        
        const emptyStars = 5 - Math.ceil(product.rating);
        for (let i = 1; i <= emptyStars; i++) {
          const star = document.createElement('i');
          star.className = 'fa fa-star-o';
          ratingContainer.appendChild(star);
        }
        
        const viewsContainer = document.createElement('div');
        viewsContainer.className = 'text-gray-500 text-sm flex items-center';
        viewsContainer.innerHTML = `<i class="fa fa-eye mr-1"></i> ${product.views.toLocaleString()}`;
        
        productMeta.appendChild(ratingContainer);
        productMeta.appendChild(viewsContainer);
        productInfo.appendChild(productName);
        productInfo.appendChild(productMeta);
        productCard.appendChild(imageContainer);
        productCard.appendChild(productInfo);
        productGrid.appendChild(productCard);
        
        // 点击图片打开产品详情
        imageContainer.addEventListener('click', (e) => {
          // 防止事件冒泡导致重复打开
          if (e.target === imageContainer || e.target === img) {
            openProductModal(product);
          }
        });
        
        lazyLoadImage(img, product.image);
      });
    }
    
    // 打开产品详情弹窗
    function openProductModal(product) {
      const tempImg = new Image();
      tempImg.src = product.image;
      tempImg.onload = function() {
        modalImage.src = product.image;
        modalImage.alt = product.name;
      };
      
      modalTitle.textContent = product.name;
      
      modalRating.innerHTML = '';
      const fullStars = Math.floor(product.rating);
      const hasHalfStar = product.rating % 1 !== 0;
      
      for (let i = 1; i <= fullStars; i++) {
        const star = document.createElement('i');
        star.className = 'fa fa-star';
        modalRating.appendChild(star);
      }
      
      if (hasHalfStar) {
        const halfStar = document.createElement('i');
        halfStar.className = 'fa fa-star-half-o';
        modalRating.appendChild(halfStar);
      }
      
      const emptyStars = 5 - Math.ceil(product.rating);
      for (let i = 1; i <= emptyStars; i++) {
        const star = document.createElement('i');
        star.className = 'fa fa-star-o';
        modalRating.appendChild(star);
      }
      
      modalViews.textContent = product.views.toLocaleString();
      modalDescription.textContent = product.description;
      
      productModal.classList.remove('hidden');
      productModal.classList.add('flex');
      productBackdrop.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    // 关闭产品弹窗
    function closeProductModal() {
      productModal.classList.add('hidden');
      productModal.classList.remove('flex');
      productBackdrop.classList.remove('active');
      document.body.style.overflow = paymentOpen ? 'hidden' : '';
    }
    
    // 导航按钮点击事件
    navButtons.forEach(button => {
      button.addEventListener('click', () => {
        const category = parseInt(button.getAttribute('data-category'));
        if (category !== currentCategory) {
          currentCategory = category;
          
          navButtons.forEach(btn => {
            btn.classList.remove('nav-active');
            btn.classList.add('bg-gray-100', 'hover:bg-gray-200');
          });
          button.classList.add('nav-active');
          button.classList.remove('bg-gray-100', 'hover:bg-gray-200');
          
          renderProducts(category);
          
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        }
      });
    });
    
    // 付款窗口控制
    function togglePaymentWindow() {
      paymentOpen = !paymentOpen;
      if (paymentOpen) {
        paymentWindow.classList.remove('hidden');
        paymentToggle.classList.add('hidden');
        paymentBackdrop.classList.add('active');
        document.body.style.overflow = 'hidden';
      } else {
        paymentWindow.classList.add('hidden');
        paymentToggle.classList.remove('hidden');
        paymentBackdrop.classList.remove('active');
        document.body.style.overflow = '';
      }
    }
    
    // 处理图片上传
    function handleReceiptUpload() {
      uploadedSection.classList.remove('hidden');
      
      setTimeout(() => {
        uploadedSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    }
    
    // 联系客服弹窗控制
    function toggleContactModal(show) {
      if (show) {
        contactModal.classList.remove('hidden');
        contactModal.classList.add('flex');
        contactBackdrop.classList.add('active');
        document.body.style.overflow = 'hidden';
      } else {
        contactModal.classList.add('hidden');
        contactModal.classList.remove('flex');
        contactBackdrop.classList.remove('active');
        document.body.style.overflow = paymentOpen ? 'hidden' : '';
      }
    }
    
    // 事件监听
    closeModal.addEventListener('click', closeProductModal);
    productModal.addEventListener('click', (e) => {
      if (e.target === productModal) closeProductModal();
    });
    productBackdrop.addEventListener('click', closeProductModal);
    
    openPaymentFromProduct.addEventListener('click', () => {
      closeProductModal();
      togglePaymentWindow();
    });
    
    loadMoreBtn.addEventListener('click', togglePaymentWindow);
    
    paymentToggle.addEventListener('click', togglePaymentWindow);
    closePayment.addEventListener('click', togglePaymentWindow);
    paymentBackdrop.addEventListener('click', togglePaymentWindow);
    
    receiptUpload.addEventListener('change', (e) => {
      if (e.target.files && e.target.files[0] && e.target.files[0].type.startsWith('image/')) {
        handleReceiptUpload();
      }
    });
    
    contactBtn.addEventListener('click', () => toggleContactModal(true));
    closeContact.addEventListener('click', () => toggleContactModal(false));
    contactModal.addEventListener('click', (e) => {
      if (e.target === contactModal) toggleContactModal(false);
    });
    contactBackdrop.addEventListener('click', () => toggleContactModal(false));
    
    // 键盘ESC关闭弹窗
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (!productModal.classList.contains('hidden')) closeProductModal();
        else if (!contactModal.classList.contains('hidden')) toggleContactModal(false);
        else if (paymentOpen) togglePaymentWindow();
      }
    });
    
    // 初始渲染
    renderProducts(currentCategory);
  </script>
</body>
</html>

